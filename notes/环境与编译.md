## 构建环境

### 开发环境简述

开发的系统是windows，然后编译器是`mingw-w64`，不使用IDE，直接通过`makefile`在`powershell`里面进行编译。

至于编译器的配置，在`c和c++代码组织与编译`里面我已经说了，总而言之我现在用的就是一个64位的编译器，因为异常处理模型选择了`sjlj`，所以也可以通过`-m32`使用32位模式。

编译方法：我会尽量使用Makefile实现编译

我还不清楚这样做会不会为以后带来问题，这么着先，出问题再说。

### 基础依赖

这一部分要说明一下需要以来的库，以及编译方法，这一部分基本是从`archive/study_notes/c与c++代码组织与编译`中摘出来，整理的

#### 窗口生成与管理

负责窗口生成与管理的库是`glfw`，旧版的有人使用`glut`，前者要比后者有前途。

起到简化`glfw`与windows交互作用的一个库是`glad`，旧版的有人使用`glew`，同样要比后者优秀。

##### glad

glad是一个c库，直接去官网下载，按照[learnopengl](https://learnopengl-cn.github.io/01%20Getting%20started/02%20Creating%20a%20window/)上面的配置说明配置我们需要的，然后下载压缩包即可，需要的应该就是里面的c代码和头文件。

##### glfw

glfw直接下载源码，编译需要Cmake，关于这一部分我在`OpenGL笔记`里面有描述，就不细说了，这个的编译是非常顺利的，会在`example`文件夹生成很多酷炫的例子。

对于glfw需要的是`libglfw3.a`和`glfw3.h`

其余的以来就是OpenGL的库，这里主要依赖的三个库是`opengl32, glu32 gdi32`，这些已经包含在`windows`的系统库里面了，不需要额外安装



### 纹理

纹理的加载使用`stb_image.h`，这个库是单头文件库，只包含了一个头文件。

但是，使用的时候还是需要自己搞一个`stb_imag.cpp`，编译成`stb_image.o`，然后链接到最终的目标文件内，为什么会这样，我也不知道。

`stb_image.cpp`的内容如下：

~~~c++
#define STB_IMAGE_IMPLEMENTATION
#include "stb_image.h"
~~~

编译没有什么很特别的地方。



### GLM

`GLM`是向量与矩阵数学库，同样只有头文件，只需要放进头文件目录就好。



### ASSIMP

昨天晚上我又尝试了一次ASSIMP的编译，因为原本的编译丢弃了太多的支持格式，我很不满意，这一次首先是确认了编译器，再查一些资料，我还是有点信心的。

这一次的编译很奇怪，其实还是蛮顺利的，使用当前的编译器，配合Cmake，使用的assimp版本是`4.1.0`，唯一需要做出特别处理的是cmake里面的配置，我在尝试编译时遇到过`view`发生了错误，直接导致了编译终止，所以在cmake里面取消了勾选`ASSIMP_BUILD_ASSIMP_VIEW`选项，然后根据以前老的编译记录，我也勾选了`ASSIMP_BUILD_ZLIB`来创建自己的zlib，根据测试，这样config然后generate，接下来使用`mingw32-make`编译是没有问题的，虽然编译中会有巨量的警告，但是至少没有错误。

至于编译产物，在选择的build文件夹中可以看到一个code文件夹，里面有`libassimp.dll和libassimp.dll.a`两个库。

在`OpenGL笔记`里面我还曾记录需要zlib的库和头文件，但实际上我现在没有弄也没问题。

在使用中，首先需要`assimp`的库，然后还需要他的头文件，头文件位于源代码的`include`文件夹中，把整个`assimp`文件夹拷贝进入头文件目录。额外的还少了一个`config.h`头文件，这个位于编译完成的文件夹的`include/assimp`中，也放进去就可以了。

这一次，原则上来说，我应该没有再强制删除那么多格式，assimp应该是完美的，但是因为上一次学习的记录不全，我现在没有可以成功编译的代码，没办法测试编译成果。

额外，[这个网页](https://bruceoutdoors.wordpress.com/2014/08/22/building-assimp-3-with-mingw-4-8/)告诉我们，可以加一个`release`，似乎这样是编译出来体积会小一些的吧，我也忘了对比了。

所以，现在就是这样。

还可以在编译完后的`test`文件夹发现一个`unit.exe`，可以在命令行运行一下，看起来是一个类似单元测试什么的，从结果来看，我还是有两个测试没通过。

还会生成一个`test.3mf`，win10可以直接打开。

##### assimp的使用

如上所述，将我们的静态动态两个链接库放入库文件夹中，将上述组合之后的`assimp`头文件夹放入头文件夹中，assimp就准备好可以使用了。注意，静态链接库的名字要修改一下，删掉里面的`.dll`

编译时只需要额外的加一个参数`-lassimp`就可以了